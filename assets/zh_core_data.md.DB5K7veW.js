import{_ as i,c as a,o as t,aj as n}from"./chunks/framework.CFr_S-Bc.js";const g=JSON.parse('{"title":"数据流水线","description":"Torch-RecHub 数据加载与预处理","frontmatter":{"title":"数据流水线","description":"Torch-RecHub 数据加载与预处理"},"headers":[],"relativePath":"zh/core/data.md","filePath":"zh/core/data.md"}'),l={name:"zh/core/data.md"};function e(h,s,p,k,r,d){return t(),a("div",null,[...s[0]||(s[0]=[n(`<h1 id="数据流水线" tabindex="-1">数据流水线 <a class="header-anchor" href="#数据流水线" aria-label="Permalink to “数据流水线”">​</a></h1><p>Torch-RecHub提供了完整的数据处理流水线，包括数据集类、数据生成器和工具函数，用于处理推荐系统中的各种数据需求。</p><h2 id="数据类" tabindex="-1">数据类 <a class="header-anchor" href="#数据类" aria-label="Permalink to “数据类”">​</a></h2><h3 id="torchdataset" tabindex="-1">TorchDataset <a class="header-anchor" href="#torchdataset" aria-label="Permalink to “TorchDataset”">​</a></h3><p>用于训练和验证的数据集合，包含特征和标签。</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch_rechub.utils.data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TorchDataset</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建数据集</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dataset </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> TorchDataset(x, y)</span></span></code></pre></div><p><strong>参数说明：</strong></p><ul><li><code>x</code>：特征字典，键为特征名称，值为特征数据</li><li><code>y</code>：标签数据</li></ul><h3 id="predictdataset" tabindex="-1">PredictDataset <a class="header-anchor" href="#predictdataset" aria-label="Permalink to “PredictDataset”">​</a></h3><p>用于预测的数据集合，仅包含特征。</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch_rechub.utils.data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PredictDataset</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建预测数据集</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dataset </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PredictDataset(x)</span></span></code></pre></div><p><strong>参数说明：</strong></p><ul><li><code>x</code>：特征字典，键为特征名称，值为特征数据</li></ul><h2 id="数据生成器" tabindex="-1">数据生成器 <a class="header-anchor" href="#数据生成器" aria-label="Permalink to “数据生成器”">​</a></h2><h3 id="datagenerator" tabindex="-1">DataGenerator <a class="header-anchor" href="#datagenerator" aria-label="Permalink to “DataGenerator”">​</a></h3><p>用于生成排序模型和多任务模型的数据加载器。</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch_rechub.utils.data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DataGenerator</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建数据生成器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DataGenerator(x, y)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成数据加载器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">train_dl, val_dl, test_dl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dg.generate_dataloader(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    split_ratio</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 训练集:验证集:测试集比例</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    batch_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 批次大小</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    num_workers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             # 并行工作线程数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>参数说明：</strong></p><ul><li><code>x</code>：特征数据</li><li><code>y</code>：标签数据</li></ul><p><strong>generate_dataloader方法参数：</strong></p><ul><li><code>split_ratio</code>：数据分割比例，长度为2</li><li><code>batch_size</code>：批次大小</li><li><code>num_workers</code>：并行工作线程数</li></ul><h3 id="matchdatagenerator" tabindex="-1">MatchDataGenerator <a class="header-anchor" href="#matchdatagenerator" aria-label="Permalink to “MatchDataGenerator”">​</a></h3><p>用于生成召回模型的数据加载器。</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch_rechub.utils.data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MatchDataGenerator</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 创建召回数据生成器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">dg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> MatchDataGenerator(x, y)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成数据加载器</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">train_dl, test_dl, item_dl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> dg.generate_dataloader(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    x_test_user</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x_test_user,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 测试用户数据</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    x_all_item</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">x_all_item,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 所有物品数据</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    batch_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 批次大小</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    num_workers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">             # 并行工作线程数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>参数说明：</strong></p><ul><li><code>x</code>：特征数据</li><li><code>y</code>：标签数据，可选</li></ul><p><strong>generate_dataloader方法参数：</strong></p><ul><li><code>x_test_user</code>：测试用户数据</li><li><code>x_all_item</code>：所有物品数据</li><li><code>batch_size</code>：批次大小</li><li><code>num_workers</code>：并行工作线程数</li></ul><h2 id="工具函数" tabindex="-1">工具函数 <a class="header-anchor" href="#工具函数" aria-label="Permalink to “工具函数”">​</a></h2><h3 id="get-auto-embedding-dim" tabindex="-1">get_auto_embedding_dim <a class="header-anchor" href="#get-auto-embedding-dim" aria-label="Permalink to “get_auto_embedding_dim”">​</a></h3><p>根据类别数量自动计算嵌入向量长度。</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch_rechub.utils.data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_auto_embedding_dim</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 自动计算嵌入向量长度</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">embed_dim </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_auto_embedding_dim(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">vocab_size</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>参数说明：</strong></p><ul><li><code>num_classes</code>：类别数量</li></ul><p><strong>返回值：</strong></p><ul><li>嵌入向量长度，计算公式：<code>int(np.floor(6 * np.pow(num_classes, 0.25)))</code></li></ul><h3 id="get-loss-func" tabindex="-1">get_loss_func <a class="header-anchor" href="#get-loss-func" aria-label="Permalink to “get_loss_func”">​</a></h3><p>根据任务类型获取对应的损失函数。</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> torch_rechub.utils.data </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_loss_func</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取分类任务损失函数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">loss_func </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_loss_func(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">task_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;classification&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取回归任务损失函数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">loss_func </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> get_loss_func(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">task_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;regression&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><p><strong>参数说明：</strong></p><ul><li><code>task_type</code>：任务类型，可选值：classification（分类）、regression（回归）</li></ul><p><strong>返回值：</strong></p><ul><li>对应的损失函数实例</li></ul><h2 id="数据处理流程" tabindex="-1">数据处理流程 <a class="header-anchor" href="#数据处理流程" aria-label="Permalink to “数据处理流程”">​</a></h2><ol><li><strong>特征定义</strong>：使用DenseFeature、SparseFeature、SequenceFeature定义特征</li><li><strong>数据加载</strong>：加载原始数据</li><li><strong>特征编码</strong>：对类别型特征进行LabelEncoder编码</li><li><strong>序列处理</strong>：对序列特征进行填充、截断等处理</li><li><strong>样本构造</strong>：构造训练样本，包括负采样等</li><li><strong>数据生成</strong>：使用DataGenerator或MatchDataGenerator生成数据加载器</li><li><strong>模型训练</strong>：将数据加载器传入模型进行训练</li></ol>`,45)])])}const c=i(l,[["render",e]]);export{g as __pageData,c as default};
