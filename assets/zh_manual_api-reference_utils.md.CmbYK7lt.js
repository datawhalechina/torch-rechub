import{_ as l,c as a,o as i,ah as t}from"./chunks/framework.B-q_H0pu.js";const g=JSON.parse('{"title":"工具类 API 参考","description":"Torch-RecHub 工具类的 API 文档，包括数据处理、向量检索和多任务学习工具","frontmatter":{"title":"工具类 API 参考","description":"Torch-RecHub 工具类的 API 文档，包括数据处理、向量检索和多任务学习工具"},"headers":[],"relativePath":"zh/manual/api-reference/utils.md","filePath":"zh/manual/api-reference/utils.md"}'),o={name:"zh/manual/api-reference/utils.md"};function r(n,e,d,s,c,h){return i(),a("div",null,[...e[0]||(e[0]=[t('<h1 id="工具类-api-参考" tabindex="-1">工具类 API 参考 <a class="header-anchor" href="#工具类-api-参考" aria-label="Permalink to “工具类 API 参考”">​</a></h1><p>本文档详细介绍 Torch-RecHub 中各个工具类的 API 接口和参数说明。</p><h2 id="数据处理工具-data-py" tabindex="-1">数据处理工具 (data.py) <a class="header-anchor" href="#数据处理工具-data-py" aria-label="Permalink to “数据处理工具 (data.py)”">​</a></h2><h3 id="数据集类" tabindex="-1">数据集类 <a class="header-anchor" href="#数据集类" aria-label="Permalink to “数据集类”">​</a></h3><h4 id="torchdataset" tabindex="-1">TorchDataset <a class="header-anchor" href="#torchdataset" aria-label="Permalink to “TorchDataset”">​</a></h4><ul><li><strong>简介</strong>：PyTorch数据集的基础实现，用于处理特征和标签数据。</li><li><strong>参数</strong>： <ul><li><code>x</code> (dict): 特征字典，键为特征名，值为特征数据</li><li><code>y</code> (array): 标签数据</li></ul></li></ul><h4 id="predictdataset" tabindex="-1">PredictDataset <a class="header-anchor" href="#predictdataset" aria-label="Permalink to “PredictDataset”">​</a></h4><ul><li><strong>简介</strong>：用于预测阶段的数据集类，只包含特征数据。</li><li><strong>参数</strong>： <ul><li><code>x</code> (dict): 特征字典，键为特征名，值为特征数据</li></ul></li></ul><h4 id="matchdatagenerator" tabindex="-1">MatchDataGenerator <a class="header-anchor" href="#matchdatagenerator" aria-label="Permalink to “MatchDataGenerator”">​</a></h4><ul><li><strong>简介</strong>：召回任务的数据生成器，用于生成训练和测试数据加载器。</li><li><strong>主要方法</strong>： <ul><li><code>generate_dataloader(x_test_user, x_all_item, batch_size, num_workers=8)</code>: 生成训练、测试和物品数据加载器</li><li><strong>参数</strong>： <ul><li><code>x_test_user</code> (dict): 测试用户特征</li><li><code>x_all_item</code> (dict): 所有物品特征</li><li><code>batch_size</code> (int): 批次大小</li><li><code>num_workers</code> (int): 数据加载的工作进程数</li></ul></li></ul></li></ul><h4 id="datagenerator" tabindex="-1">DataGenerator <a class="header-anchor" href="#datagenerator" aria-label="Permalink to “DataGenerator”">​</a></h4><ul><li><strong>简介</strong>：通用数据生成器，支持数据集的划分和加载。</li><li><strong>主要方法</strong>： <ul><li><code>generate_dataloader(x_val=None, y_val=None, x_test=None, y_test=None, split_ratio=None, batch_size=16, num_workers=0)</code>: 生成训练、验证和测试数据加载器</li><li><strong>参数</strong>： <ul><li><code>x_val</code>, <code>y_val</code>: 验证集特征和标签</li><li><code>x_test</code>, <code>y_test</code>: 测试集特征和标签</li><li><code>split_ratio</code> (list): 训练集、验证集、测试集的划分比例</li><li><code>batch_size</code> (int): 批次大小</li><li><code>num_workers</code> (int): 数据加载的工作进程数</li></ul></li></ul></li></ul><h3 id="工具函数" tabindex="-1">工具函数 <a class="header-anchor" href="#工具函数" aria-label="Permalink to “工具函数”">​</a></h3><h4 id="get-auto-embedding-dim" tabindex="-1">get_auto_embedding_dim <a class="header-anchor" href="#get-auto-embedding-dim" aria-label="Permalink to “get_auto_embedding_dim”">​</a></h4><ul><li><strong>简介</strong>：根据类别数自动计算嵌入向量维度。</li><li><strong>参数</strong>： <ul><li><code>num_classes</code> (int): 类别数量</li></ul></li><li><strong>返回</strong>： <ul><li>int: 嵌入向量维度，计算公式：<code>[6 * (num_classes)^(1/4)]</code></li></ul></li></ul><h4 id="get-loss-func" tabindex="-1">get_loss_func <a class="header-anchor" href="#get-loss-func" aria-label="Permalink to “get_loss_func”">​</a></h4><ul><li><strong>简介</strong>：获取损失函数。</li><li><strong>参数</strong>： <ul><li><code>task_type</code> (str): 任务类型，&quot;classification&quot;或&quot;regression&quot;</li></ul></li><li><strong>返回</strong>： <ul><li>torch.nn.Module: 对应的损失函数</li></ul></li></ul><h4 id="get-metric-func" tabindex="-1">get_metric_func <a class="header-anchor" href="#get-metric-func" aria-label="Permalink to “get_metric_func”">​</a></h4><ul><li><strong>简介</strong>：获取评估指标函数。</li><li><strong>参数</strong>： <ul><li><code>task_type</code> (str): 任务类型，&quot;classification&quot;或&quot;regression&quot;</li></ul></li><li><strong>返回</strong>： <ul><li>function: 对应的评估指标函数</li></ul></li></ul><h4 id="generate-seq-feature" tabindex="-1">generate_seq_feature <a class="header-anchor" href="#generate-seq-feature" aria-label="Permalink to “generate_seq_feature”">​</a></h4><ul><li><strong>简介</strong>：生成序列特征和负样本。</li><li><strong>参数</strong>： <ul><li><code>data</code> (pd.DataFrame): 原始数据</li><li><code>user_col</code> (str): 用户ID列名</li><li><code>item_col</code> (str): 物品ID列名</li><li><code>time_col</code> (str): 时间戳列名</li><li><code>item_attribute_cols</code> (list): 需要生成序列特征的物品属性列</li><li><code>min_item</code> (int): 用户最少交互物品数</li><li><code>shuffle</code> (bool): 是否打乱数据</li><li><code>max_len</code> (int): 序列最大长度</li></ul></li></ul><h2 id="召回工具-match-py" tabindex="-1">召回工具 (match.py) <a class="header-anchor" href="#召回工具-match-py" aria-label="Permalink to “召回工具 (match.py)”">​</a></h2><h3 id="数据处理函数" tabindex="-1">数据处理函数 <a class="header-anchor" href="#数据处理函数" aria-label="Permalink to “数据处理函数”">​</a></h3><h4 id="gen-model-input" tabindex="-1">gen_model_input <a class="header-anchor" href="#gen-model-input" aria-label="Permalink to “gen_model_input”">​</a></h4><ul><li><strong>简介</strong>：合并用户和物品特征，处理序列特征。</li><li><strong>参数</strong>： <ul><li><code>df</code> (pd.DataFrame): 带有历史序列特征的数据</li><li><code>user_profile</code> (pd.DataFrame): 用户特征数据</li><li><code>user_col</code> (str): 用户列名</li><li><code>item_profile</code> (pd.DataFrame): 物品特征数据</li><li><code>item_col</code> (str): 物品列名</li><li><code>seq_max_len</code> (int): 序列最大长度</li><li><code>padding</code> (str): 填充方式，&#39;pre&#39;或&#39;post&#39;</li><li><code>truncating</code> (str): 截断方式，&#39;pre&#39;或&#39;post&#39;</li></ul></li></ul><h4 id="negative-sample" tabindex="-1">negative_sample <a class="header-anchor" href="#negative-sample" aria-label="Permalink to “negative_sample”">​</a></h4><ul><li><strong>简介</strong>：召回模型的负采样方法。</li><li><strong>参数</strong>： <ul><li><code>items_cnt_order</code> (dict): 物品计数字典，按计数降序排序</li><li><code>ratio</code> (int): 负样本比例</li><li><code>method_id</code> (int): 采样方法ID <ul><li>0: 随机采样</li><li>1: Word2Vec式流行度采样</li><li>2: 对数流行度采样</li><li>3: 腾讯RALM采样</li></ul></li></ul></li></ul><h3 id="向量检索类" tabindex="-1">向量检索类 <a class="header-anchor" href="#向量检索类" aria-label="Permalink to “向量检索类”">​</a></h3><h4 id="annoy" tabindex="-1">Annoy <a class="header-anchor" href="#annoy" aria-label="Permalink to “Annoy”">​</a></h4><ul><li><strong>简介</strong>：基于Annoy的向量召回工具。</li><li><strong>参数</strong>： <ul><li><code>metric</code> (str): 距离度量方式</li><li><code>n_trees</code> (int): 树的数量</li><li><code>search_k</code> (int): 搜索参数</li></ul></li><li><strong>主要方法</strong>： <ul><li><code>fit(X)</code>: 构建索引</li><li><code>query(v, n)</code>: 查询最近邻</li></ul></li></ul><h4 id="milvus" tabindex="-1">Milvus <a class="header-anchor" href="#milvus" aria-label="Permalink to “Milvus”">​</a></h4><ul><li><strong>简介</strong>：基于Milvus的向量召回工具。</li><li><strong>参数</strong>： <ul><li><code>dim</code> (int): 向量维度</li><li><code>host</code> (str): Milvus服务器地址</li><li><code>port</code> (str): Milvus服务器端口</li></ul></li><li><strong>主要方法</strong>： <ul><li><code>fit(X)</code>: 构建索引</li><li><code>query(v, n)</code>: 查询最近邻</li></ul></li></ul><h2 id="多任务学习工具-mtl-py" tabindex="-1">多任务学习工具 (mtl.py) <a class="header-anchor" href="#多任务学习工具-mtl-py" aria-label="Permalink to “多任务学习工具 (mtl.py)”">​</a></h2><h3 id="工具函数-1" tabindex="-1">工具函数 <a class="header-anchor" href="#工具函数-1" aria-label="Permalink to “工具函数”">​</a></h3><h4 id="shared-task-layers" tabindex="-1">shared_task_layers <a class="header-anchor" href="#shared-task-layers" aria-label="Permalink to “shared_task_layers”">​</a></h4><ul><li><strong>简介</strong>：获取多任务模型中的共享层和任务特定层参数。</li><li><strong>参数</strong>： <ul><li><code>model</code> (torch.nn.Module): 多任务模型，支持MMOE、SharedBottom、PLE、AITM</li></ul></li><li><strong>返回</strong>： <ul><li>list: 共享层参数列表</li><li>list: 任务特定层参数列表</li></ul></li></ul><h3 id="优化器类" tabindex="-1">优化器类 <a class="header-anchor" href="#优化器类" aria-label="Permalink to “优化器类”">​</a></h3><h4 id="metabalance" tabindex="-1">MetaBalance <a class="header-anchor" href="#metabalance" aria-label="Permalink to “MetaBalance”">​</a></h4><ul><li><strong>简介</strong>：MetaBalance优化器，用于平衡多任务学习中各任务的梯度。</li><li><strong>参数</strong>： <ul><li><code>parameters</code> (list): 模型参数</li><li><code>relax_factor</code> (float): 梯度缩放的松弛因子，默认0.7</li><li><code>beta</code> (float): 移动平均系数，默认0.9</li></ul></li><li><strong>主要方法</strong>： <ul><li><code>step(losses)</code>: 执行优化步骤，更新参数</li></ul></li></ul><h3 id="梯度处理函数" tabindex="-1">梯度处理函数 <a class="header-anchor" href="#梯度处理函数" aria-label="Permalink to “梯度处理函数”">​</a></h3><h4 id="gradnorm" tabindex="-1">gradnorm <a class="header-anchor" href="#gradnorm" aria-label="Permalink to “gradnorm”">​</a></h4><ul><li><strong>简介</strong>：实现GradNorm算法，用于动态调整多任务学习中的任务权重。</li><li><strong>参数</strong>： <ul><li><code>loss_list</code> (list): 各任务的损失列表</li><li><code>loss_weight</code> (list): 任务权重列表</li><li><code>share_layer</code> (torch.nn.Parameter): 共享层参数</li><li><code>initial_task_loss</code> (list): 初始任务损失列表</li><li><code>alpha</code> (float): GradNorm算法的超参数</li></ul></li></ul>',42)])])}const m=l(o,[["render",r]]);export{g as __pageData,m as default};
